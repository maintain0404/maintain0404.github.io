<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Supabase의 소소한 사용 팁들 | Taein.dev</title>
<meta name=keywords content="supabase,postgres"><meta name=description content="Supabase 사용 팁을 정리해봤습니다."><meta name=author content="Me"><link rel=canonical href=https://maintain0404.github.io/posts/supabase-tips.ko/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://maintain0404.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://maintain0404.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://maintain0404.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://maintain0404.github.io/apple-touch-icon.png><link rel=mask-icon href=https://maintain0404.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-HBTP6KYQ2X"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HBTP6KYQ2X",{anonymize_ip:!1})}</script><meta property="og:title" content="Supabase의 소소한 사용 팁들"><meta property="og:description" content="Supabase 사용 팁을 정리해봤습니다."><meta property="og:type" content="article"><meta property="og:url" content="https://maintain0404.github.io/posts/supabase-tips.ko/"><meta property="og:image" content="https://maintain0404.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-13T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-13T00:00:00+00:00"><meta property="og:site_name" content="Taein.dev"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://maintain0404.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Supabase의 소소한 사용 팁들"><meta name=twitter:description content="Supabase 사용 팁을 정리해봤습니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://maintain0404.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Supabase의 소소한 사용 팁들","item":"https://maintain0404.github.io/posts/supabase-tips.ko/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Supabase의 소소한 사용 팁들","name":"Supabase의 소소한 사용 팁들","description":"Supabase 사용 팁을 정리해봤습니다.","keywords":["supabase","postgres"],"articleBody":"들어가며 | 이 글은 supabase를 처음 사용하며, API 서버 없이 활용하려는 사람들에게 가장 유용합니다.\n최근에 프로젝트에서 풀스택으로 개발하면서 주로 supabase를 사용하고 있습니다. 저는 Backend 개발자로 시작했지만 supabase 덕분에 최근에 API를 작성할 일이 모두 없어졌습니다. Next.js를 처음 공부하면서 작업하느라 여러 어려움이 많았는데 supabase가 없었다면 지금보다 시간을 1.5배 정도 썼을 것 같습니다. 수개월 간 supabase를 사용하면서 얻은 팁들을 정리해봤습니다.\n팁 테이블 선언 및 마이그레이션 최대한 정규화 수준을 높여서 엄격한 데이터 모델을 만드는 것이 좋습니다. 낮은 정규화 수준을 보완해줄 백엔드가 없기 때문에 정규화 수준은 더욱 중요합니다. 자동 생성된 typescript타입이 정확해지고, 클라이언트 사용이 편리해집니다. jsonschema 확장을 통해 보완할 수 있습니다. 타입은 supabase gen types 명령어로 자동 생성할 수 있습니다. # 로컬 supabase를 사용해서 typescript로 생성하는 예시 supabase gen types typescript --local \u003e src/types/database.types.ts 마이그레이션 supabase migration new 명령어로 마이그레이션 파일을 생성하고, supabase db diff 명령어로 마이그레이션을 자동으로 만들 수 있습니다. # 빈 supabase/migrations/XXXXXXXXXXXXXX_create-application-function.sql 파일이 생깁니다. supabase migration new create-application-function # 마이그레이션 내용을 자동으로 생성해 채웁니다. supabase db diff --local \u003e supabase/migrations/XXXXXXXXXXXXXX_create-application-function.sql 컬럼 타입 변경은 수동으로 해야 합니다. 이 점 유의해주세요. RPC 작성하기 트랜잭션 Supabase 클라이언트는 트랜잭션을 지원하지 않습니다(참조). 여러 쿼리를 한 번에 실행하고 싶다면 RPC(Remote Procedure Call)가 필요합니다. 또한 view는 타입을 생성했을 때 모든 프로퍼티가 optional로 처리되기 때문에 RPC가 더 좋습니다. AI로 쉽게 작성하기 plpgsql이 익숙하지 않다면 ChatGPT, Claude 등 LLM에 요구사항을 정의하고 plpgsql을 작성해달라고 요청하면 빠르게 만들 수 있습니다. p_, v_ 접두사를 붙여주는 경우가 많은데 키워드 충돌 때문에 그렇습니다. 접두사가 불편하더라도 웬만하면 쓰는 게 덜 귀찮습니다. 저는 접두사 빼고 싶어서 조금씩 고쳐쓰긴 했습니다. jsonschema 확장을 설치하면 요청 데이터 검증이 편리합니다. 데이터 형태가 복잡하다면 고려해보세요. 서버에서만 실행할 수 있게 하기 클라이언트에서 RPC 실행을 막으려면 RPC 인자에 비밀키를 추가하고 서버 환경변수로 비밀키를 관리해서 서버에서만 실행할 수 있게 하는 방법이 제일 간단합니다. 서버에서 anon_key 대신 service_role_key를 사용하는 방법이 있으나 저는 잘 되지 않았습니다. CREATE OR REPLACE FUNCTION complex_business_logic( IN p_user_id INTEGER, IN p_action VARCHAR(50), IN p_secret_key VARCHAR(100) ) RETURNS integer AS $$ DECLARE v_result INTEGER; BEGIN IF p_secret_key IS NULL OR p_secret_key != 'p_secret_key' THEN RETURN QUERY SELECT 0::INTEGER, '인증 실패: 잘못된 비밀키'::VARCHAR; RETURN; END IF; -- 트랜잭션이 필요한 데이터 저장 로직 ... END; $$ LANGUAGE plpgsql; // 서버에서 호출 const response = await supabase.rpc('complex_business_logic', { p_user_id: 1, p_action: 'create', p_secret_key: process.env.SERVER_SECRET // p_scret_key와 동일한 값 }); Row Level Security 안전한 클라이언트 사용을 위해 RLS는 필수적입니다. supabase에서 추천하는 RLS는 테이블 user_id 컬럼을 사용합니다. author_id, owner_id 같은 이름보다 user_id를 추천합니다. Column Level Security도 가능하니 참고해보세요. 트리거 조회수, 좋아요, 댓글 수 기능을 트리거와 Column Level Security를 통해 구현할 수 있습니다. -- 좋아요 기능 예시 -- 좋아요 post_like 테이블 레코드가 추가되었을 때, post의 likes_cnt 1 올리는 트리거 함수 CREATE OR REPLACE FUNCTION \"feature-community\".update_post_comment_count() RETURNS trigger LANGUAGE plpgsql SECURITY DEFINER AS $function$ begin update \"feature-community\".post SET comments_cnt = (select comments_cnt from \"feature-community\".post where id = new.post_id) + 1 WHERE id = new.post_id; RETURN new; end $function$ ; 기타 기본 FULL TEXT SEARCH 기능은 한글 검색 시 조사/어미 처리를 제대로 하지 못합니다. 한글 검색용 postgresql 확장(textsearch_ko)이 있지만 관리형 supabase에서 사용하는 방법은 현재 없는 것 같습니다. React를 사용하는 경우 supabase-cache-helper 라이브러리를 사용하면 요청 실패, 로딩 처리를 쉽게 할 수 있습니다. 사용방법은 기본적으로 SWR이나 react-query와 동일합니다. ","wordCount":"503","inLanguage":"en","image":"https://maintain0404.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-13T00:00:00Z","dateModified":"2024-10-13T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://maintain0404.github.io/posts/supabase-tips.ko/"},"publisher":{"@type":"Organization","name":"Taein.dev","logo":{"@type":"ImageObject","url":"https://maintain0404.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://maintain0404.github.io/ accesskey=h title="Taein.dev (Alt + H)"><img src=https://maintain0404.github.io/apple-touch-icon.png alt aria-label=logo height=35>Taein.dev</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://maintain0404.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://maintain0404.github.io/archives title=archives><span>archives</span></a></li><li><a href=https://maintain0404.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://maintain0404.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://maintain0404.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Supabase의 소소한 사용 팁들</h1><div class=post-meta><span title='2024-10-13 00:00:00 +0000 UTC'>October 13, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;503 words&nbsp;·&nbsp;Me</div></header><div class=post-content><h2 id=들어가며>들어가며<a hidden class=anchor aria-hidden=true href=#들어가며>#</a></h2><p>| 이 글은 supabase를 처음 사용하며, API 서버 없이 활용하려는 사람들에게 가장 유용합니다.</p><p>최근에 프로젝트에서 풀스택으로 개발하면서 주로 supabase를 사용하고 있습니다. 저는 Backend 개발자로 시작했지만 supabase 덕분에 최근에 API를 작성할 일이 모두 없어졌습니다. Next.js를 처음 공부하면서 작업하느라 여러 어려움이 많았는데 supabase가 없었다면 지금보다 시간을 1.5배 정도 썼을 것 같습니다. 수개월 간 supabase를 사용하면서 얻은 팁들을 정리해봤습니다.</p><h2 id=팁>팁<a hidden class=anchor aria-hidden=true href=#팁>#</a></h2><h3 id=테이블-선언-및-마이그레이션>테이블 선언 및 마이그레이션<a hidden class=anchor aria-hidden=true href=#테이블-선언-및-마이그레이션>#</a></h3><ul><li>최대한 정규화 수준을 높여서 엄격한 데이터 모델을 만드는 것이 좋습니다.<ul><li>낮은 정규화 수준을 보완해줄 백엔드가 없기 때문에 정규화 수준은 더욱 중요합니다.</li><li>자동 생성된 typescript타입이 정확해지고, 클라이언트 사용이 편리해집니다.</li><li>jsonschema 확장을 통해 보완할 수 있습니다.</li></ul></li><li>타입은 supabase gen types 명령어로 자동 생성할 수 있습니다.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 로컬 supabase를 사용해서 typescript로 생성하는 예시</span>
</span></span><span class=line><span class=cl>supabase gen types typescript --local &gt; src/types/database.types.ts    
</span></span></code></pre></div><h3 id=마이그레이션>마이그레이션<a hidden class=anchor aria-hidden=true href=#마이그레이션>#</a></h3><ul><li>supabase migration new 명령어로 마이그레이션 파일을 생성하고, supabase db diff 명령어로 마이그레이션을 자동으로 만들 수 있습니다.<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 빈 supabase/migrations/XXXXXXXXXXXXXX_create-application-function.sql 파일이 생깁니다.</span>
</span></span><span class=line><span class=cl>supabase migration new create-application-function
</span></span><span class=line><span class=cl><span class=c1># 마이그레이션 내용을 자동으로 생성해 채웁니다.</span>
</span></span><span class=line><span class=cl>supabase db diff --local &gt; supabase/migrations/XXXXXXXXXXXXXX_create-application-function.sql
</span></span></code></pre></div></li><li>컬럼 타입 변경은 수동으로 해야 합니다. 이 점 유의해주세요.</li></ul><h3 id=rpc-작성하기>RPC 작성하기<a hidden class=anchor aria-hidden=true href=#rpc-작성하기>#</a></h3><h3 id=트랜잭션>트랜잭션<a hidden class=anchor aria-hidden=true href=#트랜잭션>#</a></h3><ul><li>Supabase 클라이언트는 트랜잭션을 지원하지 않습니다(<a href=https://github.com/PostgREST/postgrest/issues/286>참조</a>). 여러 쿼리를 한 번에 실행하고 싶다면 <a href=https://supabase.com/docs/reference/javascript/rpc>RPC(Remote Procedure Call)</a>가 필요합니다.<ul><li>또한 view는 타입을 생성했을 때 모든 프로퍼티가 optional로 처리되기 때문에 RPC가 더 좋습니다.</li></ul></li></ul><h4 id=ai로-쉽게-작성하기>AI로 쉽게 작성하기<a hidden class=anchor aria-hidden=true href=#ai로-쉽게-작성하기>#</a></h4><ul><li>plpgsql이 익숙하지 않다면 ChatGPT, Claude 등 LLM에 요구사항을 정의하고 plpgsql을 작성해달라고 요청하면 빠르게 만들 수 있습니다.<ul><li>p_, v_ 접두사를 붙여주는 경우가 많은데 키워드 충돌 때문에 그렇습니다. 접두사가 불편하더라도 웬만하면 쓰는 게 덜 귀찮습니다. 저는 접두사 빼고 싶어서 조금씩 고쳐쓰긴 했습니다.</li></ul></li><li><a href="https://github.com/supabase/pg_jsonschema?tab=readme-ov-file">jsonschema 확장</a>을 설치하면 요청 데이터 검증이 편리합니다. 데이터 형태가 복잡하다면 고려해보세요.</li></ul><h4 id=서버에서만-실행할-수-있게-하기>서버에서만 실행할 수 있게 하기<a hidden class=anchor aria-hidden=true href=#서버에서만-실행할-수-있게-하기>#</a></h4><ul><li>클라이언트에서 RPC 실행을 막으려면 RPC 인자에 비밀키를 추가하고 서버 환경변수로 비밀키를 관리해서 서버에서만 실행할 수 있게 하는 방법이 제일 간단합니다.<ul><li>서버에서 anon_key 대신 service_role_key를 사용하는 방법이 있으나 저는 잘 되지 않았습니다.<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>complex_business_logic</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IN</span><span class=w> </span><span class=n>p_user_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IN</span><span class=w> </span><span class=n>p_action</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IN</span><span class=w> </span><span class=n>p_secret_key</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=k>RETURNS</span><span class=w> </span><span class=nb>integer</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DECLARE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>v_result</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IF</span><span class=w> </span><span class=n>p_secret_key</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>p_secret_key</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s1>&#39;p_secret_key&#39;</span><span class=w> </span><span class=k>THEN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>RETURN</span><span class=w> </span><span class=n>QUERY</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=mi>0</span><span class=p>::</span><span class=nb>INTEGER</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;인증 실패: 잘못된 비밀키&#39;</span><span class=p>::</span><span class=nb>VARCHAR</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>RETURN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>END</span><span class=w> </span><span class=k>IF</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 트랜잭션이 필요한 데이터 저장 로직
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w> </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpgsql</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// 서버에서 호출
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>supabase</span><span class=p>.</span><span class=nx>rpc</span><span class=p>(</span><span class=s1>&#39;complex_business_logic&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p_user_id</span>: <span class=kt>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>p_action</span><span class=o>:</span> <span class=s1>&#39;create&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>p_secret_key</span>: <span class=kt>process.env.SERVER_SECRET</span>  <span class=c1>// p_scret_key와 동일한 값
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></div></li></ul></li></ul><h3 id=row-level-security>Row Level Security<a hidden class=anchor aria-hidden=true href=#row-level-security>#</a></h3><ul><li>안전한 클라이언트 사용을 위해 RLS는 필수적입니다.</li><li>supabase에서 추천하는 RLS는 테이블 <code>user_id</code> 컬럼을 사용합니다. <code>author_id</code>, <code>owner_id</code> 같은 이름보다 <code>user_id</code>를 추천합니다.</li><li>Column Level Security도 가능하니 <a href=https://supabase.com/docs/guides/database/postgres/column-level-security#manage-column-privileges-in-the-dashboard>참고</a>해보세요.</li></ul><h3 id=트리거>트리거<a hidden class=anchor aria-hidden=true href=#트리거>#</a></h3><ul><li>조회수, 좋아요, 댓글 수 기능을 트리거와 Column Level Security를 통해 구현할 수 있습니다.<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 좋아요 기능 예시
</span></span></span><span class=line><span class=cl><span class=c1>-- 좋아요 post_like 테이블 레코드가 추가되었을 때, post의 likes_cnt 1 올리는 트리거 함수
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=s2>&#34;feature-community&#34;</span><span class=p>.</span><span class=n>update_post_comment_count</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RETURNS</span><span class=w> </span><span class=k>trigger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpgsql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SECURITY</span><span class=w> </span><span class=k>DEFINER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w> </span><span class=err>$</span><span class=k>function</span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>begin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>update</span><span class=w> </span><span class=s2>&#34;feature-community&#34;</span><span class=p>.</span><span class=n>post</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>comments_cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>comments_cnt</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=s2>&#34;feature-community&#34;</span><span class=p>.</span><span class=n>post</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=p>.</span><span class=n>post_id</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=p>.</span><span class=n>post_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RETURN</span><span class=w> </span><span class=k>new</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>end</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$</span><span class=k>function</span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li></ul><h3 id=기타>기타<a hidden class=anchor aria-hidden=true href=#기타>#</a></h3><ul><li>기본 FULL TEXT SEARCH 기능은 한글 검색 시 조사/어미 처리를 제대로 하지 못합니다. 한글 검색용 postgresql 확장(<a href=https://github.com/i0seph/textsearch_ko>textsearch_ko</a>)이 있지만 관리형 supabase에서 사용하는 방법은 현재 없는 것 같습니다.</li><li>React를 사용하는 경우 <a href=https://github.com/psteinroe/supabase-cache-helpers>supabase-cache-helper</a> 라이브러리를 사용하면 요청 실패, 로딩 처리를 쉽게 할 수 있습니다. 사용방법은 기본적으로 SWR이나 react-query와 동일합니다.</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://maintain0404.github.io/tags/supabase/>supabase</a></li><li><a href=https://maintain0404.github.io/tags/postgres/>postgres</a></li></ul><nav class=paginav><a class=prev href=https://maintain0404.github.io/posts/pycon2024-review/><span class=title>« Prev</span><br><span>Pycon2024에서 발표한 후기</span>
</a><a class=next href=https://maintain0404.github.io/posts/starting_small_service.ko/><span class=title>Next »</span><br><span>작은 서비스를 위한 인프라 선택하기</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Supabase의 소소한 사용 팁들 on x" href="https://x.com/intent/tweet/?text=Supabase%ec%9d%98%20%ec%86%8c%ec%86%8c%ed%95%9c%20%ec%82%ac%ec%9a%a9%20%ed%8c%81%eb%93%a4&amp;url=https%3a%2f%2fmaintain0404.github.io%2fposts%2fsupabase-tips.ko%2f&amp;hashtags=supabase%2cpostgres"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Supabase의 소소한 사용 팁들 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmaintain0404.github.io%2fposts%2fsupabase-tips.ko%2f&amp;title=Supabase%ec%9d%98%20%ec%86%8c%ec%86%8c%ed%95%9c%20%ec%82%ac%ec%9a%a9%20%ed%8c%81%eb%93%a4&amp;summary=Supabase%ec%9d%98%20%ec%86%8c%ec%86%8c%ed%95%9c%20%ec%82%ac%ec%9a%a9%20%ed%8c%81%eb%93%a4&amp;source=https%3a%2f%2fmaintain0404.github.io%2fposts%2fsupabase-tips.ko%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Supabase의 소소한 사용 팁들 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmaintain0404.github.io%2fposts%2fsupabase-tips.ko%2f&title=Supabase%ec%9d%98%20%ec%86%8c%ec%86%8c%ed%95%9c%20%ec%82%ac%ec%9a%a9%20%ed%8c%81%eb%93%a4"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Supabase의 소소한 사용 팁들 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmaintain0404.github.io%2fposts%2fsupabase-tips.ko%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Supabase의 소소한 사용 팁들 on whatsapp" href="https://api.whatsapp.com/send?text=Supabase%ec%9d%98%20%ec%86%8c%ec%86%8c%ed%95%9c%20%ec%82%ac%ec%9a%a9%20%ed%8c%81%eb%93%a4%20-%20https%3a%2f%2fmaintain0404.github.io%2fposts%2fsupabase-tips.ko%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Supabase의 소소한 사용 팁들 on telegram" href="https://telegram.me/share/url?text=Supabase%ec%9d%98%20%ec%86%8c%ec%86%8c%ed%95%9c%20%ec%82%ac%ec%9a%a9%20%ed%8c%81%eb%93%a4&amp;url=https%3a%2f%2fmaintain0404.github.io%2fposts%2fsupabase-tips.ko%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Supabase의 소소한 사용 팁들 on ycombinator" href="https://news.ycombinator.com/submitlink?t=Supabase%ec%9d%98%20%ec%86%8c%ec%86%8c%ed%95%9c%20%ec%82%ac%ec%9a%a9%20%ed%8c%81%eb%93%a4&u=https%3a%2f%2fmaintain0404.github.io%2fposts%2fsupabase-tips.ko%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=maintain0404/blog issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://maintain0404.github.io/>Taein.dev</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>